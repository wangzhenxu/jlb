<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">


<mapper namespace="ProductApp">
	<resultMap type="ProductApp" id="productAppMap">
		<result column="pa_id" property="paId"/>
		<result column="pac_id" property="pacId"/>
		<result column="big_pic" property="bigPic"/>
		<result column="small_pic" property="smallPic"/>
		<result column="doc_url" property="docUrl"/>
		<result column="p_desc" property="PDesc"/>
		<result column="tech_para" property="techPara"/>
		<result column="install" property="install"/>
		<result column="status" property="status"/>
		<result column="create_time" property="createTime"/>
		<result column="account_id" property="accountId"/>
		<result column="user_name" property="userName"/>
		<result column="pac_name" property="pacName"/>
		<result column="static_url" property="staticUrl"/>
		<result column="price" property="price"/>
		<result column="publish_type" property="publishType"/>
		<result column="recommend" property="recommend"/>
	</resultMap>
	
	<!-- 查询产品接口 -->
	<select id="productAppList" resultMap="productAppMap">
		SELECT
		   pa.*, pac.`name` AS pac_name,
       		 a.username AS user_name
		FROM
		product_app pa 
		LEFT JOIN product_app_cat  pac ON pa.pac_id = pac.pac_id
		LEFT JOIN account a ON a.account_id=pa.account_id
		<where>
		    <if test="pacId !=NULL">
	      		 pa.pac_id=#{pacId}
		   </if>
		   <if test="paId !=NULL">
	      		 pa.pa_id=#{paId}
		   </if>
		    <if test="name !=NULL and name!=''">
        		AND pa.name like '%${name}%'
		    </if>
	  </where>
	  ORDER BY pa.pa_id desc 
	   <trim prefix="limit" suffixOverrides=",">
			<if test="skipResults != null">#{skipResults},</if>
			<if test="maxResults != null">#{maxResults},</if>
		</trim>
	</select>
	
	<!--查询所有系统信息 -->
	<select  id="getProductApp_AllList" resultMap="productAppMap">
			SELECT 
			 	*
			FROM product_app
	</select>
	
	<!-- 查询系统信息总数 -->
	<select id="getProductAppListCount"  resultType="Integer">
		SELECT count(*) FROM product_app pa
        <where>
		     <if test="pacId !=NULL">
	      		 pa.pac_id=#{pacId}
		   </if>
		    <if test="name !=NULL and name!=''">
        		AND pa.name like '%${name}%'
		    </if>
	   	</where>
	</select>
	
	<!-- 添加系统-->
	<insert id="addProductApp"  >
	    INSERT INTO product_app 
		    (
				pac_id,
				`name`,
				big_pic,
				small_pic,
				doc_url,
				p_desc,
				tech_para,
				`install`,
				`status`,
				create_time,
				account_id,
				price,
				publish_type,
				recommend
			)
		VALUES
		   (
				#{pacId},#{name},#{bigPic},#{smallPic},#{docUrl},#{PDesc},#{techPara},#{install},
				#{status},#{createTime},#{accountId},#{price},#{publishType},#{recommend}
		   );
		   <selectKey resultType="java.lang.Long" order="AFTER" keyProperty="paId">  
         		 SELECT LAST_INSERT_ID()   
			</selectKey> 
		    
	</insert>
	
	<!-- 是否可以添加-->
	<select  id="isAdd"  resultType="Integer">
		SELECT COUNT(*) FROM product_app
		WHERE 
		name=#{name}
		<if test="paId != null"> AND pa_id not in(#{paId})</if>
	</select>
	
	<!--修改系统信息 -->
	<update id="updateProductApp">
	   		UPDATE product_app 
	   			<trim prefix="set" suffixOverrides=",">
					<if test="pacId != null">pac_id= #{pacId},</if>
					<if test="name != null">name= #{name},</if>
				    <if test="bigPic != null">big_pic= #{bigPic},</if>
					<if test="smallPic != null">small_pic= #{smallPic},</if>
					<if test="docUrl != null">doc_url= #{docUrl},</if>
					<if test="PDesc != null">p_desc= #{PDesc},</if>
					<if test="techPara != null">tech_para=#{techPara},</if>
					<if test="install != null">install=#{install},</if>
					<if test="status != null">status=#{status},</if>
					<if test="staticUrl != null">static_url=#{staticUrl},</if>
					<if test="price != null">price=#{price},</if>
					<if test="publishType != null">publish_type=#{publishType},</if>
					<if test="recommend != null">recommend=#{recommend},</if>
					
				</trim>
				<where>
					<if test="paId != null">
	 					and pa_id = #{paId}
					</if>
				</where>
	</update>
	
	<!-- 是否可以删除-->
	<select  id="isDelete"  resultType="Integer">
		SELECT COUNT(*) FROM cms_solution_product_map 
		WHERE 
		pa_id=#{paId}
	</select>
	
	<!--删除系统信息 -->
	<delete id="deleteProductApp" >
	    DELETE FROM product_app WHERE pa_id=#{paId}
	</delete>
	

	
</mapper>