<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

	<!-- ******************************************** 产品分类相关sql ******************************************** -->

<mapper namespace="ProductAppCat">
	<resultMap type="ProductAppCat" id="productClazz">
		<id column="pac_id" property="pacId" />
		<result column="name" property="name" />
		<result column="create_time" property="createTime" />
		<result column="account_id" property="accountId" />
		<collection property="appList" ofType="ProductApp">
			<id column="pa_id" property="paId"/>
			<result column="pa_name" property="name"/>
			<result column="static_url" property="staticUrl"/>
		</collection>
	</resultMap>
	
	
	<!-- 查询产品分类信息 -->
	<select  id="getProduct_Clazz_List" resultMap="productClazz" >
		SELECT * FROM product_app_cat
        <where>
            <if test="classname !=NULL">
        	name like '%${classname}%'
		    </if>
	   	</where>
	   	ORDER BY pac_id desc 
	   	limit #{skipResults},#{maxResults}
	</select>
	
		<!-- 查询产品分类级联到产品 -->
	<select  id="queryCatCascadeProduct_List" resultMap="productClazz" >
		SELECT
			pac.`name`,
			pac.pac_id,
			pa.pa_id,
			pa.`name` AS pa_name,
			pa.static_url
		FROM
			product_app_cat pac
		LEFT JOIN product_app pa ON pac.pac_id = pa.pac_id AND pa.publish_type = 1
		ORDER BY
			pac.pac_id ASC,
			pa.pa_id ASC
	</select>
	
	
	<!--查询所有产品分类信息 -->
	<select  id="getProduct_Clazz_AllList" resultMap="productClazz">
	SELECT 	pac_id, 
	NAME
	FROM 
	product_app_cat
	</select>
	
	<!-- 查询产品分类总数 -->
	<select id="getProductClassListCount"  resultType="Integer">
	 SELECT COUNT(*)
 	  FROM product_app_cat 
	  <where>
	    <if test="classname !=NULL">
        name like '%${classname}%'
	   </if>
	  </where>
	</select>
	
	<!-- 增加产品分类信息 -->
	<insert id="addProduct_Clazz"  >
	    INSERT INTO product_app_cat  (name,create_time,account_id)  VALUES (#{name},now(),#{accountId});
	</insert>
	
	<!-- 是否可以添加-->
	<select  id="isAddClass"  resultType="Integer">
		SELECT COUNT(*) FROM product_app_cat 
		WHERE 
		name=#{name}
	</select>
	
	<!-- 是否可以删除-->
	<select  id="isDeleteClass"  resultType="Integer">
		SELECT COUNT(*) FROM product_app 
		WHERE 
		pac_id=#{pacId}
	</select>
	
	<!--删除产品分类信息 -->
	<delete id="deleteProduct_Clazz" >
	    DELETE FROM product_app_cat WHERE pac_id=#{pacId}
	</delete>
	
	<!--修改产品分类信息 -->
	<update id="updateProduct_Clazz">
	   UPDATE product_app_cat SET NAME=#{name} WHERE pac_id=#{pacId}
	</update>
	
	<!-- ******************************************** 产品相关sql ******************************************** -->
	<resultMap type="ProductApp" id="productAppMap">
		<result column="pa_id" property="paId"/>
		<result column="pac_id" property="pacId"/>
		<result column="big_pic" property="bigPic"/>
		<result column="small_pic" property="smallPic"/>
		<result column="doc_url" property="docUrl"/>
		<result column="p_desc" property="PDesc"/>
		<result column="tech_para" property="techPara"/>
		<result column="install" property="install"/>
		<result column="status" property="status"/>
		<result column="create_time" property="createTime"/>
		<result column="account_id" property="accountId"/>
		<result column="price" property="price"/>
		<result column="publish_type" property="publishType"/>
	</resultMap>
	
	<!-- 查询产品接口 -->
	<select id="productAppList" resultMap="productAppMap">
		SELECT
		   * 
		FROM
		product_app pa 
		<where>
		    <if test="pacId !=NULL">
	      		and pa.pac_id=#{pacId}
		   </if>
		   <if test="paId !=NULL">
	      		and pa.pa_id=#{paId}
		   </if>
		   <if test="publishType !=NULL">
	      		and pa.publish_type=#{publishType}
		   </if>
	  </where>
	</select>
</mapper>