<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="Node">

	<resultMap type="Node" id="node">
		<result column="node_id" property="nodeId" />
		<result column="scene_id" property="sceneId" />
		<result column="product_id" property="productId" />
		<result column="sn_value" property="snValue" />
		<result column="name" property="name" />
		<result column="show_type" property="showType" />
		<result column="product_type" property="productType" />
		<result column="is_delete" property="isDelete" />
	</resultMap>


	<resultMap type="NodeTrigger" id="nodeTrigger">
		<id column="nt_id" property="ntId" />
		<result column="title" property="title" />
		<collection property="conditionList" ofType="NodeCondition">
			<id column="nc_id" property="ncId" />
			<result column="nt_id" property="ntId" />
			<result column="na_id" property="naId" />
			<result column="node_id" property="nodeId" />
			<result column="operator_char" property="operatorChar" />
			<result column="value" property="value" />
		</collection>
	</resultMap>

	<resultMap type="NodeAttribute" id="nodeAttribute">
		<result column="na_id" property="naId" />
		<result column="node_id" property="nodeId" />
		<result column="attr_key" property="attrKey" />
		<result column="title" property="title" />
		<result column="is_show" property="isShow" />
		<result column="unit" property="unit" />
		<result column="symbol" property="symbol" />
	</resultMap>

	<resultMap type="NodeCommand" id="nodeCommand">
		<result column="nc_id" property="ncId" />
		<result column="ncg_id" property="ncgId" />
		<result column="node_id" property="nodeId" />
		<result column="cmd_str" property="cmdStr" />
		<result column="title" property="title" />
		<association property="nodeCommandGroup" javaType="NodeCommandGroup">
			<result column="ncg_id" property="ncgId" />
			<result column="node_id" property="nodeId" />
			<result column="cmd_key" property="cmdKey" />
			<result column="title" property="title" />
		</association>
	</resultMap>

	<resultMap type="NodeActionAlert" id="nodeActionAlert">
		<result column="naa_id" property="naaId" />
		<result column="nt_id" property="ntId" />
		<result column="action_type" property="actionType" />
		<result column="value" property="value" />
		<result column="content" property="content" />
	</resultMap>

	<!-- 根据节点序列号查找节点 -->
	<select id="getNodeBySn" resultMap="node">
		select * from node
		where
		sn_value=#{sn}
	</select>

	<!-- 根据节点ID查询节点触发器列表 -->
	<select id="getNodeTriggerListById" resultMap="nodeTrigger">
		select * from
		node_condition nc,node_trigger nt
		where nt.nt_id=nt.nt_id and
		nc.node_id=#{nodeId}
	</select>

	<!-- 根据节点SN查询节点触发器列表 -->
	<select id="getNodeTriggerListBySn" resultMap="nodeTrigger">
		select * from
		node_condition nc,node_trigger nt,node n
		where nc.nt_id=nt.nt_id and
		n.node_id=nc.node_id and
		n.sn_value=#{sn}
	</select>

	<!-- 根据节点属性ID查询节点属性 -->
	<select id="getNodeAttributeById" resultMap="nodeAttribute">
		select * from
		node_attribute where
		na_id=#{naId}
	</select>

	<!-- 根据节点属性ID查询节点命令列表 -->
	<select id="getNodeCommandListById" resultMap="nodeCommand">
		select * from
		node_command nc,node_action_command nac,node_command_group ncg where
		nc.nc_id=nac.nc_id and ncg.ncg_id=nc.ncg_id and
		nac.nt_id=#{ntId}
	</select>

	<!-- 根据节点属性ID查询节点警报列表 -->
	<select id="getNodeActionAlertListById" resultMap="nodeActionAlert">
		select * from
		node_action_alert nac where nac.nt_id=#{ntId}
	</select>

</mapper>